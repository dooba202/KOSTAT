<?xml version="1.0" encoding="UTF-8"?>

<dbQuery jdbc="KOSTAT" category="jisu">

	<select id="getJisuListWithIndustryCode" >
		select  
			sanid
		  , pumid
		  , j.jisu_gu
		     , (select description 
		  		from code_mst
				where code_grp = 'JISU_GU'
			    and code = j.jisu_gu
		       ) AS "JISU_GU_NM"
		  , josa_ym
		  , to_number( to_date(josa_ym,'YYYYMM') - to_date('19700101','YYYYMMDD')) * (24 * 60 * 60 * 1000) as sec
		  , sum(jisu) / count(*) "JISU"
		  from mi_jisu j
		where 1=1
		   and jisu_gu in ('P1','S1','D1','E1','H1')
		   and jisuid = 'ON1'
		   and sanid =  ? 
		   and pumid =  ? 
		   and josa_ym between ? and ? 
		 group by 
		    josa_ym
		  , jisu_gu
		  , jisuid
		  , sanid
		  , pumid
		 order by 
		    jisu_gu
		  , josa_ym
		  , sanid
	</select>
	
	<select id="getJisuLMListWithIndustryCode">
	-- 산업별 지수 전월비 
	select sanid, pumid, jisu_gu,
	  (select description 
	   from code_mst
	   where code_grp = 'JISU_GU'
	          and code = j.jisu_gu
	    ) AS jisu_gu_nm
	  , DATE_DESC josa_ym
	  , to_number( to_date(DATE_DESC,'YYYYMM') - to_date('19700101','YYYYMMDD')) * (24 * 60 * 60 * 1000) as sec
	  , j.rate JISU
	  from mi_jisu_analysis j
	 where jisuid = 'O11'
	   and rate_gu = 'LM'-- 'LM' 전월비 / 'SM' 전년동월비
	   and jisu_gu in ('P1','S1','D1','E1','H1')
	   and sanid = ? -- 산업코드
	   and pumid = ?  -- 품목코드
	   and DATE_DESC between ? and ? 
	 order by 
	       j.sanid
	     , j.jisu_gu
	     , j.date_desc
	</select>

	<select id="getJisuLMListWithIndustryCodeForNotZeroPumId">
	select 
		sanid, pumid, jisu_gu,
		(select description 
	             from code_mst
	           where code_grp = 'JISU_GU'
	              and code = j.jisu_gu
	         ) AS jisu_gu_nm
	  , DATE_DESC josa_ym
	  , to_number( to_date(DATE_DESC,'YYYYMM') - to_date('19700101','YYYYMMDD')) * (24 * 60 * 60 * 1000) as sec
	  , j.rate JISU 
	  from mi_jisu_analysis_m j
	 where jisuid = 'O11'
	   and rate_gu = 'LM'-- 'LM' 전월비 / 'SM' 전년동월비
	   and jisu_gu in ('P1','S1','D1','E1','H1')
--	   and sanid = ? -- 산업코드
	   and sanid like ? || '%'
	   and pumid = ? -- 품목코드
	   and DATE_DESC between ? and ?
	 order by 
	       j.sanid
	     , j.jisu_gu
	     , j.date_desc
	</select>

	
	<select id="getJisuSMListWithIndustryCode">
	-- 산업별 지수 전년동월비
	select sanid, pumid, jisu_gu,
	 	(select description 
		 from code_mst
		 where code_grp = 'JISU_GU'
	  	 and code = j.jisu_gu
	    ) AS jisu_gu_nm
	  , DATE_DESC josa_ym
	  , to_number( to_date(DATE_DESC,'YYYYMM') - to_date('19700101','YYYYMMDD')) * (24 * 60 * 60 * 1000) as sec
	  , j.rate JISU 
	  from mi_jisu_analysis j
	 where jisuid = 'O11'
	   and rate_gu = 'SM'-- 'LM' 전월비 / 'SM' 전년동월비
	   and jisu_gu in ('P1','S1','D1','E1','H1')
	   and sanid = ? -- 산업코드
	   and pumid = ?  -- 품목코드 
	   and DATE_DESC between ? and ? 
	 order by 
	       j.sanid
	     , j.jisu_gu
	     , j.date_desc	
	</select>	
	
	<select id="getJisuSMListWithIndustryCodeForNotZeroPumId">
	select 
		sanid, pumid, jisu_gu,
		(select description 
	             from code_mst
	           where code_grp = 'JISU_GU'
	              and code = j.jisu_gu
	          ) AS jisu_gu_nm
	  , DATE_DESC josa_ym
	  , to_number( to_date(DATE_DESC,'YYYYMM') - to_date('19700101','YYYYMMDD')) * (24 * 60 * 60 * 1000) as sec
	  , j.rate JISU  
	  from mi_jisu_analysis_m j
	 where jisuid = 'O11'
	   and rate_gu = 'SM'-- 'LM' 전월비 / 'SM' 전년동월비
	   and jisu_gu in ('P1','S1','D1','E1','H1')
--	   and sanid = ? -- 산업코드
	   and sanid like ? || '%'
	   and pumid = ?  -- 품목코드 
	   and DATE_DESC between ? and ? 
	 order by 
	       j.sanid
	     , j.jisu_gu
	     , j.date_desc	
	</select>	


</dbQuery>


